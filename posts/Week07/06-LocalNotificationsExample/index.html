<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Mobile Application Development for the iOS Platform"/><link rel="canonical" href="https://hococoder.com/posts/Week07/06-LocalNotificationsExample"/><meta name="twitter:url" content="https://hococoder.com/posts/Week07/06-LocalNotificationsExample"/><meta name="og:url" content="https://hococoder.com/posts/Week07/06-LocalNotificationsExample"/><title>Week 7 - Local Notifications Example | Mobile Application Development for the iOS Platform</title><meta name="twitter:title" content="Week 7 - Local Notifications Example | Mobile Application Development for the iOS Platform"/><meta name="og:title" content="Week 7 - Local Notifications Example | Mobile Application Development for the iOS Platform"/><meta name="description" content="A description of my first post."/><meta name="twitter:description" content="A description of my first post."/><meta name="og:description" content="A description of my first post."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><link rel="stylesheet" href="../../../styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Mobile Application Development for the iOS Platform"/></head><body><header><div class="wrapper"><a class="site-name" href="/">Mobile Application Development for the iOS Platform</a><nav><ul><li><a href="/epp_605_687_spring_2024/posts/Intro/About Me">AboutMe</a></li><li><a href="/epp_605_687_spring_2024/posts/Intro/Example App">ExampleApp</a></li><li><a href="/epp_605_687_spring_2024/posts/Week00/00-Week00Overview">Week0</a></li><li><a href="/epp_605_687_spring_2024/posts/Week01/00-Week01Overview">Week1</a></li><li><a href="/epp_605_687_spring_2024/posts/Week02/00-Week02Overview">Week2</a></li><li><a href="/epp_605_687_spring_2024/posts/Week03/00-Week03Overview">Week3</a></li><li><a href="/epp_605_687_spring_2024/posts/Week04/00-Week04Overview">Week4</a></li><li><a href="/epp_605_687_spring_2024/posts/Week05/00-Week05Overview">Week5</a></li><li><a href="/epp_605_687_spring_2024/posts/Week06/00-Week06Overview">Week6</a></li><li><a href="/epp_605_687_spring_2024/posts/Week07/00-Week07Overview">Week7</a></li><li><a href="/epp_605_687_spring_2024/posts/Week08/00-Week08Overview">Week8</a></li><li><a href="/epp_605_687_spring_2024/posts/Week09/00-Week09Overview">Week9</a></li><li><a href="/epp_605_687_spring_2024/posts/Week10/00-Week10Overview">Week10</a></li><li><a href="/epp_605_687_spring_2024/posts/Week11/00-Week11Overview">Week11</a></li><li><a href="/epp_605_687_spring_2024/posts/Week12/00-Week12Overview">Week12</a></li><li><a href="/epp_605_687_spring_2024/posts/Week13/00-Week13Overview">Week13</a></li></ul></nav></div></header><div class="wrapper"><h1>Week 7 - Local Notifications Example</h1><p style="float: left">Previous:  <A HREF="../05-IntroductionToNotifications/index.html">Introduction to Notifications</A></p><p style="float: right">Next:  <A HREF="../07-NotificationDetailExample/index.html" class="nextModule">Notification Detail Example</A></p><BR/><BR/><center> <iframe width="1280" height="720" src="https://cdnapisec.kaltura.com/html5/html5lib/v2.81.2/mwEmbedFrame.php/p/1458241/uiconf_id/14487351/entry_id/1_rzulttar?wid=_1458241&iframeembed=true&playerId=kaltura_player&entry_id=1_rzulttar&flashvars[localizationCode]=en&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[mediaProxy.preferedFlavorBR]=2500&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;flashvars[EmbedPlayer.NotPlayableDownloadLink]=true;&wid=1_abkvs1gz"allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" sandbox="allow-forms allow-same-origin allow-scripts allow-top-navigation allow-pointer-lock allow-popups allow-modals allow-orientation-lock allow-popups-to-escape-sandbox allow-presentation allow-top-navigation-by-user-activation" frameborder="0" title="Kaltura Player">
  </iframe>
</center><p>Start by putting a button in a SwiftUI view to trigger the notification. We’re using this just so we can force a trigger to occur, but you would normally have a notification fire in response to something that has happened in your app.</p><pre><code><span class="type">Button</span>(<span class="string">"Fire Notification"</span>) {
  <span class="keyword">self</span>.<span class="call">setupAndFireNotification</span>()
}
</code></pre><p>Import the UserNotifications framework, and setup a property called notificationCenter that is of type <code>UNNotificationCenter</code>.</p><pre><code><span class="keyword">import</span> SwiftUI
<span class="keyword">import</span> UserNotifications

<span class="keyword">struct</span> NotificationsView: <span class="type">View</span> {
  
  <span class="keyword">var</span> notificationCenter:<span class="type">UNUserNotificationCenter</span>!
</code></pre><p>Initialize that notificationCenter with <code>UNUserNotificationCenter</code>’s <code>current</code> class property.</p><pre><code><span class="keyword">init</span>() {
  <span class="keyword">self</span>.<span class="property">notificationCenter</span> = <span class="type">UNUserNotificationCenter</span>.<span class="call">current</span>()
}
</code></pre><p>Make a new method called <code>setupAndFireNotification</code>, and make an array of <code>UNAuthorizationOptions</code>, declaring that we will be asking the user to allow us to present alerts and play sounds.</p><pre><code><span class="keyword">func</span> setupAndFireNotification() {

  <span class="keyword">let</span> options:<span class="type">UNAuthorizationOptions</span> = [.<span class="dotAccess">alert</span>, .<span class="dotAccess">sound</span>]
</code></pre><p>Request authorization from the user to show notifications. This is something that is typically done early on in the first launch process - the first time that a user uses your app. However, if it is the absolute first thing they see - if it was initialized in an initial view or in one of your <code>AppDelegate</code> methods, the user may dismiss it. Be sure to find a time in your on boarding process where a user is likely to accept the request, and present it then.</p><pre><code>   notificationCenter.<span class="call">requestAuthorization</span>(options: options, completionHandler:
  {
</code></pre><p>In the completion handler, do a quick check for an error, and print messages to the console either way so we know what’s going on.</p><pre><code>       success, error <span class="keyword">in
      guard</span> success == <span class="keyword">true else</span> { <span class="call">print</span>(<span class="string">"Access not granted or error"</span>); <span class="keyword">return</span> }
      <span class="call">print</span>(<span class="string">"notification access granted"</span>)
  })
</code></pre><p>OK, now we’ve got that out of the way, let’s go define the notification. First, we need to define the notification content by way of a <code>UNMutableNotificationContent</code> object. Give the content object a title - “Assignment Grading due soon” and a body - “Don’t forget, assignment 2 is due soon”.</p><pre><code>   <span class="keyword">let</span> content = <span class="type">UNMutableNotificationContent</span>()
  content.<span class="property">title</span> = <span class="string">"Assignment Grading Due soon!"</span>
  content.<span class="property">body</span> = <span class="string">"Don't forget, assignment 2 is due soon!"</span>
</code></pre><p>Set the sound to fire as the default sound in <code>UNNotificationSound</code>.</p><pre><code>   content.<span class="property">sound</span> = <span class="type">UNNotificationSound</span>.<span class="property">default</span>
</code></pre><p>We can put a delay for this notification to fire by giving it a trigger condition via <code>UNTimeIntervalNotificationTrigger</code>. We’ll choose a 5 second, non repeating trigger.</p><pre><code>   <span class="keyword">let</span> trigger = <span class="type">UNTimeIntervalNotificationTrigger</span>(timeInterval: <span class="number">5</span>, repeats: <span class="keyword">false</span>)
</code></pre><p>With those 2 objects in place, we can define our <code>UNNotificationRequest</code>. Give it a unique identifier in case we need to refer to it later, and the content and trigger objects we just defined.</p><pre><code>   <span class="keyword">let</span> notification = <span class="type">UNNotificationRequest</span>(identifier: <span class="string">"Assignment2Notification"</span>, content: content, trigger: trigger)
</code></pre><p>Finally, give it to the notification center so it can be fired. Here, we’ll do a quick check on the error condition again and put out a message to console either way.</p><pre><code>   notificationCenter.<span class="call">add</span>(notification, withCompletionHandler:
  {
      error <span class="keyword">in
      if let</span> error = error
      {
          <span class="call">print</span>(<span class="string">"Error firing notification:</span> \(error.<span class="property">localizedDescription</span>)<span class="string">"</span>)
      }
      <span class="call">print</span>(<span class="string">"adding to center"</span>)
  })
</code></pre><p>I want to be able to have the notification show if the app is in the foreground, and in order to do this, I need to implement a class and have it adopt a protocol - <code>UNUserNotificationCenterDelegate</code>. Set the notification center’s delegate as <code>self</code>, and implement the <code>userNotification:willPresent:withCompletionHandler</code> method. Put a brief console message to print out the notification’s title, and be sure to call the passed in completionHandler with the presentation options you want to use - in our case, alerts and sounds.</p><pre><code><span class="keyword">class</span> NotificationDelegate: <span class="type">NSObject</span>, <span class="type">UNUserNotificationCenterDelegate</span> {
  
  <span class="keyword">override init</span>() {
    <span class="keyword">super</span>.<span class="keyword">init</span>()
    <span class="type">UNUserNotificationCenter</span>.<span class="call">current</span>().<span class="property">delegate</span> = <span class="keyword">self</span>
  }
  
  <span class="keyword">func</span> userNotificationCenter(<span class="keyword">_</span> center: <span class="type">UNUserNotificationCenter</span>, willPresent notification: <span class="type">UNNotification</span>, withCompletionHandler completionHandler: <span class="keyword">@escaping</span> (<span class="type">UNNotificationPresentationOptions</span>) -&gt; <span class="type">Void</span>) {
    
    <span class="call">print</span>(<span class="string">"got notification in foreground"</span>)
    <span class="call">print</span>(<span class="string">"notification content</span> \(notification.<span class="property">request</span>.<span class="property">content</span>.<span class="property">title</span>)<span class="string">"</span>)
    <span class="call">completionHandler</span>([.<span class="dotAccess">banner</span>,.sound]) 
    
  }
}
</code></pre><p class="new">.banner sends the notification to an alert; .list would only send it to notification center; these can both replace .alert from iOS13, which is now deprecated</p><p>Go back and initialize this class in the view's init method</p><pre><code><span class="keyword">self</span>.<span class="property">notificationDelegate</span> = <span class="type">NotificationDelegate</span>()
</code></pre><p>Let’s run this in the simulator. When the simulator launches the app, and the view is loaded, our request to the user to allow for notifications gets called.</p><img src="../../../week07/notificationsPermissions.png#centerResized" alt="Notifications Permissions"/><p>Select allow. Press the button, wait 5 seconds, and the notification will appear. We can also fire the button, go back to the home screen, and still see the notification 5 seconds later. Finally, we can repeat that, but this time, touch the notification when it appears, which launches the app - a behavior everyone is familiar with, and you got for free with the notification. Notifications allow you to keep your user engaged with just the right amount of content, presented at whatever point in your app you need.</p><p style="float: left">Previous:  <A HREF="../05-IntroductionToNotifications/index.html">Introduction to Notifications</A></p><p style="float: right">Next:  <A HREF="../07-NotificationDetailExample/index.html" class="nextModule">Notification Detail Example</A></p></div><footer><p>Generated with ❤️ using <a href="https://github.com/johnsundell/publish">Publish</a></p><p>© 2023-2024 Josh Steele (rsteele3@jhu.edu) <a href="mailto:"(rsteele3@jhu.edu)""></a></p><p>Last updated January 21, 2024 at 1:48 PM</p><p><a href="https://mastodon.social/@hococoder" target="_blank">My Mastodon</a> | <a href="https://github.com/hococoder" target="_blank">My GitHub</a> | <a href="https://ep.jhu.edu" target="_blank">Whiting School EPP</a> | <a href="https://canvas.jhu.edu" target="_blank">JHU Canvas</a></p></footer></body></html>