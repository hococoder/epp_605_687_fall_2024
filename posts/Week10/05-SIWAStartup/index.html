<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Mobile Application Development for the iOS Platform"/><link rel="canonical" href="https://hococoder.com/posts/Week10/05-SIWAStartup"/><meta name="twitter:url" content="https://hococoder.com/posts/Week10/05-SIWAStartup"/><meta name="og:url" content="https://hococoder.com/posts/Week10/05-SIWAStartup"/><title>Week 10 - Sign in With Apple at Startup | Mobile Application Development for the iOS Platform</title><meta name="twitter:title" content="Week 10 - Sign in With Apple at Startup | Mobile Application Development for the iOS Platform"/><meta name="og:title" content="Week 10 - Sign in With Apple at Startup | Mobile Application Development for the iOS Platform"/><meta name="description" content="A description of my first post."/><meta name="twitter:description" content="A description of my first post."/><meta name="og:description" content="A description of my first post."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><link rel="stylesheet" href="../../../styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Mobile Application Development for the iOS Platform"/></head><body><header><div class="wrapper"><a class="site-name" href="/">Mobile Application Development for the iOS Platform</a><nav><ul><li><a href="/epp_605_687_spring_2024/posts/Intro/About Me">AboutMe</a></li><li><a href="/epp_605_687_spring_2024/posts/Intro/Example App">ExampleApp</a></li><li><a href="/epp_605_687_spring_2024/posts/Week00/00-Week00Overview">Week0</a></li><li><a href="/epp_605_687_spring_2024/posts/Week01/00-Week01Overview">Week1</a></li><li><a href="/epp_605_687_spring_2024/posts/Week02/00-Week02Overview">Week2</a></li><li><a href="/epp_605_687_spring_2024/posts/Week03/00-Week03Overview">Week3</a></li><li><a href="/epp_605_687_spring_2024/posts/Week04/00-Week04Overview">Week4</a></li><li><a href="/epp_605_687_spring_2024/posts/Week05/00-Week05Overview">Week5</a></li><li><a href="/epp_605_687_spring_2024/posts/Week06/00-Week06Overview">Week6</a></li><li><a href="/epp_605_687_spring_2024/posts/Week07/00-Week07Overview">Week7</a></li><li><a href="/epp_605_687_spring_2024/posts/Week08/00-Week08Overview">Week8</a></li><li><a href="/epp_605_687_spring_2024/posts/Week09/00-Week09Overview">Week9</a></li><li><a href="/epp_605_687_spring_2024/posts/Week10/00-Week10Overview">Week10</a></li><li><a href="/epp_605_687_spring_2024/posts/Week11/00-Week11Overview">Week11</a></li><li><a href="/epp_605_687_spring_2024/posts/Week12/00-Week12Overview">Week12</a></li><li><a href="/epp_605_687_spring_2024/posts/Week13/00-Week13Overview">Week13</a></li></ul></nav></div></header><div class="wrapper"><h1>Week 10 - Sign in With Apple at Startup</h1><p style="float: left">Previous:  <A HREF="../04-SIWADelegateMethods/index.html">Sign in with Apple Delegate Methods</A></p><p style="float: right">Next:  <A HREF="../06-Biometrics/index.html" class="nextModule">Biometrics</A></p><BR/><BR/><h2>Checking On Startup</h2><center> <iframe width="1280" height="720" src="https://cdnapisec.kaltura.com/html5/html5lib/v2.81.2/mwEmbedFrame.php/p/1458241/uiconf_id/14487351/entry_id/1_qqwy88bx?wid=_1458241&iframeembed=true&playerId=kaltura_player&entry_id=1_qqwy88bx&flashvars[localizationCode]=en&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[mediaProxy.preferedFlavorBR]=2500&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;flashvars[EmbedPlayer.NotPlayableDownloadLink]=true;&wid=1_abkvs1gz"allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" sandbox="allow-forms allow-same-origin allow-scripts allow-top-navigation allow-pointer-lock allow-popups allow-modals allow-orientation-lock allow-popups-to-escape-sandbox allow-presentation allow-top-navigation-by-user-activation" frameborder="0" title="Kaltura Player">
  </iframe>
</center><p>There's one more thing we can do - if the sign in page loads up, we can see if there is already either a stored AppleID credential or User/Password combination in the Keychain, and immediately prompt the user if they want to use those credentials to log in. This is going to look similar to the <code>onTapGesture</code> method we defined for the Sign in With Apple button, but this time including a Password provider request</p><pre><code>   <span class="comment">// - Tag: perform_appleid_password_request
  /// Prompts the user if an existing iCloud Keychain credential or Apple ID credential is found.</span>
  <span class="keyword">func</span> performExistingAccountSetupFlows() {
      <span class="comment">// Prepare requests for both Apple ID and password providers.</span>
      <span class="keyword">let</span> requests = [<span class="type">ASAuthorizationAppleIDProvider</span>().<span class="call">createRequest</span>(),
                      <span class="type">ASAuthorizationPasswordProvider</span>().<span class="call">createRequest</span>()]
      
      <span class="comment">// Create an authorization controller with the given requests.</span>
      <span class="keyword">let</span> authorizationController = <span class="type">ASAuthorizationController</span>(authorizationRequests: requests)
      authorizationController.<span class="property">delegate</span> = delegateHelper
      authorizationController.<span class="call">performRequests</span>()
  }
</code></pre><p>OK, now with everything properly wired up, let's start this up in the simulator and see what it looks like!<br><br></p><center> <iframe width="1280" height="720" src="https://cdnapisec.kaltura.com/html5/html5lib/v2.81.2/mwEmbedFrame.php/p/1458241/uiconf_id/14487351/entry_id/1_lcf8i4yk?wid=_1458241&iframeembed=true&playerId=kaltura_player&entry_id=1_lcf8i4yk&flashvars[localizationCode]=en&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[mediaProxy.preferedFlavorBR]=2500&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;flashvars[EmbedPlayer.NotPlayableDownloadLink]=true;&wid=1_abkvs1gz"allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" sandbox="allow-forms allow-same-origin allow-scripts allow-top-navigation allow-pointer-lock allow-popups allow-modals allow-orientation-lock allow-popups-to-escape-sandbox allow-presentation allow-top-navigation-by-user-activation" frameborder="0" title="Kaltura Player">
  </iframe>
</center><p>As you can see, when the Sign in with Apple button is tapped, the sign in controller appears on screen. It prompts the user for the full name and email properties (as we specified in our code). We can even choose the option that instead of sending the user's normal email, we can ask Apple to use Hide my Email to generate an anonymous email address that forwards any emails the app developer may send to your actual email address.</p><p>If the app is restarted, and you return to the Sign in With Apple page, the <code>performExistingAccountSetupFlows()</code> method we implemented will succeed and ask us if you want to go ahead and use the username that's stored in the Keychain.</p><p>Now you have the power to offer your users the ability to sign in with credentials they already use every day - their AppleID - with built in privacy and email-hiding capabilities, if they so desire.<br><br><br>If you have any questions on the example in this video, please post them in the forums.</p><h2>Sign in With Apple in iOS 14</h2><p>In iOS14, a native Sign In With Apple button was introduced that uses modifiers to handle dealing with requests, scopes and completion events, eliminating the need to implement protocols.</p><pre><code><span class="type">VStack</span> {
  <span class="type">SignInWithAppleButton</span>(.<span class="dotAccess">signIn</span>, onRequest: { (request) <span class="keyword">in</span>
      request.<span class="property">requestedScopes</span> = [.<span class="dotAccess">fullName</span>, .<span class="dotAccess">email</span>]
    },
    onCompletion: { (result) <span class="keyword">in
      switch</span> result {
      <span class="keyword">case</span> .<span class="dotAccess">success</span>(<span class="keyword">let</span> authorization):
        <span class="keyword">if let</span> appleIDCredential = authorization.<span class="property">credential</span> <span class="keyword">as</span>? <span class="type">ASAuthorizationAppleIDCredential</span> {
          <span class="comment">// Create an account in your system.</span>
          <span class="keyword">let</span> userIdentifier = appleIDCredential.<span class="property">user</span>
          <span class="keyword">let</span> fullName = appleIDCredential.<span class="property">fullName</span>
          <span class="keyword">let</span> email = appleIDCredential.<span class="property">email</span>

          <span class="comment">// For the purpose of this demo app, store the `userIdentifier` in the keychain.</span>
          <span class="keyword">self</span>.<span class="call">saveUserInKeychain</span>(userIdentifier)
          
          <span class="comment">// For the purpose of this demo app, save the name and email for eventual display in the app</span>
          <span class="keyword">if let</span> givenName = fullName?.<span class="property">givenName</span> {
            <span class="keyword">self</span>.<span class="property">fullName</span> = givenName
          }
          <span class="keyword">if let</span> email = email {
             <span class="keyword">self</span>.<span class="property">emailToUse</span> = email
          }
          <span class="call">print</span>(<span class="string">"using apple id"</span>)
          <span class="keyword">self</span>.<span class="property">isSignedIn</span> = <span class="keyword">true</span>
        }
        <span class="keyword">break
      case</span> .<span class="dotAccess">failure</span>(<span class="keyword">let</span> error):
          <span class="comment">//Handle error</span>
          <span class="keyword">break</span>
      }
    })
}.<span class="call">signInWithAppleButtonStyle</span>(.<span class="dotAccess">black</span>)
</code></pre><p>This uses the same <code>saveUserInKeychain</code> method as before, but the code is not repeated here.<br><br>Again, Sign in With Apple is not available unless you have a paid account, but if you do, it's even easier to setup a SiWA button with SwiftUI in iOS 14.</p><p style="float: left">Previous:  <A HREF="../04-SIWADelegateMethods/index.html">Sign in with Apple Delegate Methods</A></p><p style="float: right">Next:  <A HREF="../06-Biometrics/index.html" class="nextModule">Biometrics</A></p></div><footer><p>Generated with ❤️ using <a href="https://github.com/johnsundell/publish">Publish</a></p><p>© 2023-2024 Josh Steele (rsteele3@jhu.edu) <a href="mailto:"(rsteele3@jhu.edu)""></a></p><p>Last updated January 21, 2024 at 1:48 PM</p><p><a href="https://mastodon.social/@hococoder" target="_blank">My Mastodon</a> | <a href="https://github.com/hococoder" target="_blank">My GitHub</a> | <a href="https://ep.jhu.edu" target="_blank">Whiting School EPP</a> | <a href="https://canvas.jhu.edu" target="_blank">JHU Canvas</a></p></footer></body></html>