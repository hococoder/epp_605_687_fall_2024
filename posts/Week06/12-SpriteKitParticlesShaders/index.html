<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Mobile Application Development for the iOS Platform"/><link rel="canonical" href="https://hococoder.com/posts/Week06/12-SpriteKitParticlesShaders"/><meta name="twitter:url" content="https://hococoder.com/posts/Week06/12-SpriteKitParticlesShaders"/><meta name="og:url" content="https://hococoder.com/posts/Week06/12-SpriteKitParticlesShaders"/><title>Week 6 - SpriteKit Particles and Shaders | Mobile Application Development for the iOS Platform</title><meta name="twitter:title" content="Week 6 - SpriteKit Particles and Shaders | Mobile Application Development for the iOS Platform"/><meta name="og:title" content="Week 6 - SpriteKit Particles and Shaders | Mobile Application Development for the iOS Platform"/><meta name="description" content="A description of my first post."/><meta name="twitter:description" content="A description of my first post."/><meta name="og:description" content="A description of my first post."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><link rel="stylesheet" href="../../../styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Mobile Application Development for the iOS Platform"/></head><body><header><div class="wrapper"><a class="site-name" href="/">Mobile Application Development for the iOS Platform</a><nav><ul><li><a href="/epp_605_687_spring_2024/posts/Intro/About Me">AboutMe</a></li><li><a href="/epp_605_687_spring_2024/posts/Intro/Example App">ExampleApp</a></li><li><a href="/epp_605_687_spring_2024/posts/Week00/00-Week00Overview">Week0</a></li><li><a href="/epp_605_687_spring_2024/posts/Week01/00-Week01Overview">Week1</a></li><li><a href="/epp_605_687_spring_2024/posts/Week02/00-Week02Overview">Week2</a></li><li><a href="/epp_605_687_spring_2024/posts/Week03/00-Week03Overview">Week3</a></li><li><a href="/epp_605_687_spring_2024/posts/Week04/00-Week04Overview">Week4</a></li><li><a href="/epp_605_687_spring_2024/posts/Week05/00-Week05Overview">Week5</a></li><li><a href="/epp_605_687_spring_2024/posts/Week06/00-Week06Overview">Week6</a></li><li><a href="/epp_605_687_spring_2024/posts/Week07/00-Week07Overview">Week7</a></li><li><a href="/epp_605_687_spring_2024/posts/Week08/00-Week08Overview">Week8</a></li><li><a href="/epp_605_687_spring_2024/posts/Week09/00-Week09Overview">Week9</a></li><li><a href="/epp_605_687_spring_2024/posts/Week10/00-Week10Overview">Week10</a></li><li><a href="/epp_605_687_spring_2024/posts/Week11/00-Week11Overview">Week11</a></li><li><a href="/epp_605_687_spring_2024/posts/Week12/00-Week12Overview">Week12</a></li><li><a href="/epp_605_687_spring_2024/posts/Week13/00-Week13Overview">Week13</a></li></ul></nav></div></header><div class="wrapper"><h1>Week 6 - SpriteKit Particles and Shaders</h1><p style="float: left">Previous:  <A HREF="../11-SpriteKitBackgrounds/index.html">SpriteKit Backgrounds</A></p><p style="float: right">Next:  <A HREF="../13-SpriteKitInteractions/index.html" class="nextModule">SpriteKit Interactions</A></p><BR/><BR/><h2>Particles</h2><p>An <code>SKEmitterNode</code> can be used to render and emit small particle sprites - such as sparks, fire, or smoke. You can’t access these particles directly - they’re owned by SpriteKit - but you can act upon them and provide them a destination. You also have some ability to configure the particles by changing settings on the emitter. Xcode also comes with a Emitter Editor that lets you craft the emitter to meet your needs. Unlike the other editors, we <em>will</em> be using the Emitter Editor for this example.</p><p>You can also use a <code>SKKeyframeSequence</code> to animate properties on the particles emitted by an <code>SKEmitterNode</code>. Keyframes are an animation technique used to provide intermediate values in an animation. Only certain properties of a particle can be animated in this way.</p><h2>Particle Emitters Example</h2><center> <iframe width="1280" height="720" src="https://cdnapisec.kaltura.com/html5/html5lib/v2.81.2/mwEmbedFrame.php/p/1458241/uiconf_id/14487351/entry_id/1_wdh3s7kk?wid=_1458241&iframeembed=true&playerId=kaltura_player&entry_id=1_wdh3s7kk&flashvars[localizationCode]=en&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[mediaProxy.preferedFlavorBR]=2500&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;flashvars[EmbedPlayer.NotPlayableDownloadLink]=true;&wid=1_abkvs1gz"allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" sandbox="allow-forms allow-same-origin allow-scripts allow-top-navigation allow-pointer-lock allow-popups allow-modals allow-orientation-lock allow-popups-to-escape-sandbox allow-presentation allow-top-navigation-by-user-activation" frameborder="0" title="Kaltura Player">
  </iframe>
</center><p>When the Enterprise isn’t warping around the galaxy, it runs on Impulse Engines, which expend high speed particles out the back of the ship to propel it forward. They don’t show this particle effect on the show, but I want to show it here. For that, I can use a particle emitter.</p><ul><li>Again, let’s go the project folder, choose New File, and select “SpriteKit Particle File”, choosing the particle template as “Spark”.</li><li>Call it whatever you want (Impulse is fine).</li><li>In the properties for the pane, let’s set the following:<ul><li>The name is “impulse”, with a white background.</li><li>The texture is already set as Spark.</li><li>Set the birthrate to 100 (this dictates how often a new particle is emitted).</li><li>Set the particle range to 0,0.</li></ul></li></ul><ul><li>Next let’s set some properties that will cause it to look like it is streaming particles behind the ship.<ul><li>Set the angle to 180, and the range to 25.</li><li>Set the y component of the acceleration to -200.</li><li>Then set the color to something that will look good on a dark background - I’ve chosen orange here.</li><li>Finally, set the blend mode to alpha.</li></ul></li></ul><p>Now let’s add this to our code! Go back to the <code>GameScene.swift</code> file and make a new method called <code>addImpulseEmitter()</code>. In there, let’s define the path for the emitter in our code, using the <code>Bundle</code>’s <code>path</code> method. Then unarchive the emitter node from that file and set its position to be near the back of the ship. Give it a name, set its z position to 10 (so it is above the other items in the scene). Set the <code>targetNode</code> to self, which says that the scene’s root node is in charge of emitting the particles. Finally, add it to the scene.</p><pre><code>   <span class="keyword">func</span> addImpulseEmitter()
  {
    <span class="keyword">let</span> emitterPath:<span class="type">String</span>  = <span class="type">Bundle</span>.<span class="property">main</span>.<span class="call">path</span>(forResource: <span class="string">"Impulse"</span>, ofType: <span class="string">"sks"</span>)!
    <span class="keyword">let</span> emitterPathURL:<span class="type">URL</span> = <span class="type">URL</span>(fileURLWithPath: emitterPath)
    <span class="keyword">let</span> emitterData = <span class="keyword">try</span>? <span class="type">Data</span>(contentsOf: emitterPathURL)
    emitterNode = <span class="keyword">try</span>? <span class="type">NSKeyedUnarchiver</span>.<span class="call">unarchiveTopLevelObjectWithData</span>(emitterData!) <span class="keyword">as</span>? <span class="type">SKEmitterNode</span>
    
    emitterNode!.position = <span class="type">CGPoint</span>(x: size.<span class="property">width</span>*<span class="number">0.18</span>, y: size.<span class="property">height</span>*<span class="number">0.5</span> - <span class="number">25</span>)
    emitterNode!.name = <span class="string">"impulse"</span>
    emitterNode!.zPosition = <span class="number">10</span>
    emitterNode!.targetNode = <span class="keyword">self
    self</span>.<span class="call">addChild</span>(emitterNode!)
  }
</code></pre><p>Don't forget to update <code>didChangeSize()</code> to include the emitter</p><pre><code>   <span class="keyword">override func</span> didChangeSize(<span class="keyword">_</span> oldSize: <span class="type">CGSize</span>) {
    <span class="keyword">if</span> size != .<span class="dotAccess">zero</span>
    {
      <span class="keyword">guard</span> ship != <span class="keyword">nil</span>, shield != <span class="keyword">nil</span>, emitterNode != <span class="keyword">nil else</span> { <span class="keyword">return</span> }
      ship.<span class="property">position</span> = <span class="type">CGPoint</span>(x: size.<span class="property">width</span>*<span class="number">0.22</span>, y: size.<span class="property">height</span>*<span class="number">0.5</span>)
      shield.<span class="property">position</span> = <span class="type">CGPoint</span>(x: size.<span class="property">width</span>*<span class="number">0.30</span>, y: size.<span class="property">height</span>*<span class="number">0.5</span>)
      emitterNode!.position = <span class="type">CGPoint</span>(x: size.<span class="property">width</span>*<span class="number">0.18</span>, y: size.<span class="property">height</span>*<span class="number">0.5</span> - <span class="number">25</span>)
    }
  }
</code></pre><p>Add the <code>addImpulseEmitter()</code> method to the <code>sceneDidLoad()</code> method, and run the app.</p><pre><code>   <span class="call">addImpulseEmitter</span>()
</code></pre><p>Now you get a little more user feedback that indeed, the Enterprise is moving through space!</p><h2>Using Shaders</h2><p>If you have openGL shaders from another project - or are just an expert at writing openGL shaders, you can use a <code>SKShader</code> to store a shader that you can use in <code>SpriteKit</code>. You can use it to customize drawing behavior in your app. To use a shader in this way, it has to be written with OpenGL ES 2.0. Be sure to check out the examples video to see it in action.</p><h2>Fragment Shaders and Fields Example</h2><center> <iframe width="1280" height="720" src="https://cdnapisec.kaltura.com/html5/html5lib/v2.81.2/mwEmbedFrame.php/p/1458241/uiconf_id/14487351/entry_id/1_cxlcglai?wid=_1458241&iframeembed=true&playerId=kaltura_player&entry_id=1_cxlcglai&flashvars[localizationCode]=en&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[mediaProxy.preferedFlavorBR]=2500&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;flashvars[EmbedPlayer.NotPlayableDownloadLink]=true;&wid=1_abkvs1gz"allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" sandbox="allow-forms allow-same-origin allow-scripts allow-top-navigation allow-pointer-lock allow-popups allow-modals allow-orientation-lock allow-popups-to-escape-sandbox allow-presentation allow-top-navigation-by-user-activation" frameborder="0" title="Kaltura Player">
  </iframe>
</center><p>Let’s add one more piece to the scene. The Enterprise is usually in a solar system somewhere, so let’s add a star and a gravity field to the scene. For the star, we’ll use a VERY simple fragment shader, and for the gravity field, we’ll use a <code>SKFieldNode</code>.</p><p>First, to make the star, let’s make a simple fragment shader.</p><ul><li>In the project folder, right click, choose new File and choose empty file, and name it sun.fsh.</li><li>Then make a main method, and and define a radius of .5, and a position of a coordinate minus (0.5, 0.5).</li><li>Then do a check to see whether the length of the position is greater than the radius; if so, set the color to black, otherwise set it to red.</li><li>This method is run on each pixel within the node, which is at a given coordinate of the node, and used to determine its color.</li></ul><p>That’s it - nothing too flashy, just an example of how to make a simple shader.</p><pre><code>   void <span class="call">main</span>()
  {
    const float radius = <span class="number">0.5</span>;
    vec2 position = v_tex_coord - <span class="call">vec2</span>(<span class="number">0.5</span>, <span class="number">0.5</span>);
    
    <span class="keyword">if</span> (<span class="call">length</span>(position) &gt; radius)
    {
      gl_FragColor = <span class="call">vec4</span>(<span class="call">vec3</span>(<span class="number">0.0</span>), <span class="number">0.0</span>);
      
    }
    <span class="keyword">else</span>
    {
      gl_FragColor = <span class="call">vec4</span>(<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);
    }
  }
</code></pre><p>Back in the <code>GameScene</code> code, make a new method called <code>addSunAndGravityField()</code>, and make a new node. It doesn’t matter what image we use for the node, since we’ll be drawing over it, so I’ll just use the asteroid here. Then create an <code>SKShader </code>from the file sun.fsh that we just created. Set the node’s shader to this new shader, and set the position of the node to be midway across the bottom of the scene.</p><p class="info">Be careful when writing shaders - they don’t get checked by the built in tools like Swift.</p><p>Add the sprite to the scene.</p><pre><code>   <span class="keyword">func</span> addSunAndGravityField()
  {
    sunSprite = <span class="type">SKSpriteNode</span>(imageNamed: <span class="string">"asteroid"</span>)
    sunSprite.<span class="property">xScale</span> = <span class="number">1</span>
    sunSprite.<span class="property">yScale</span> = <span class="number">1</span>
    
    <span class="keyword">let</span> shader = <span class="type">SKShader</span>(fileNamed: <span class="string">"sun.fsh"</span>)
    sunSprite.<span class="property">shader</span> = shader
    sunSprite.<span class="property">position</span> = <span class="type">CGPoint</span>(x: size.<span class="property">width</span>/<span class="number">2</span>, y: <span class="number">0</span>)
    
    <span class="keyword">self</span>.<span class="call">addChild</span>(sunSprite)
</code></pre><p>For the gravity field, we can:</p><ul><li>Create one using <code>SKFieldNode</code>’s radial gravity field.</li><li>Make sure it’s enabled, and then put it at the same location as the star.</li><li>Assign a strength of 50 (there are no units here, it is really app dependent. We just want something that is going to pull in some of the asteroids as they fly by).</li><li>Be sure to add the gravity field to the scene.</li></ul><pre><code>     gravityField = <span class="type">SKFieldNode</span>.<span class="call">radialGravityField</span>()
    gravityField.<span class="property">isEnabled</span> = <span class="keyword">true</span>
    gravityField.<span class="property">position</span> = <span class="type">CGPoint</span>(x: size.<span class="property">width</span>/<span class="number">2</span>, y: <span class="number">0</span>)
    gravityField.<span class="property">strength</span> = <span class="number">50</span>
    
    <span class="call">addChild</span>(gravityField)
  }
</code></pre><p>Don't forget to update <code>didChangeSize()</code></p><pre><code>   <span class="keyword">override func</span> didChangeSize(<span class="keyword">_</span> oldSize: <span class="type">CGSize</span>) {
    <span class="keyword">if</span> size != .<span class="dotAccess">zero</span>
    {
      <span class="keyword">guard</span> ship != <span class="keyword">nil</span>, shield != <span class="keyword">nil</span>, emitterNode != <span class="keyword">nil</span>, sunSprite != <span class="keyword">nil</span>, gravityField != <span class="keyword">nil else</span> { <span class="keyword">return</span> }
      ship.<span class="property">position</span> = <span class="type">CGPoint</span>(x: size.<span class="property">width</span>*<span class="number">0.22</span>, y: size.<span class="property">height</span>*<span class="number">0.5</span>)
      shield.<span class="property">position</span> = <span class="type">CGPoint</span>(x: size.<span class="property">width</span>*<span class="number">0.30</span>, y: size.<span class="property">height</span>*<span class="number">0.5</span>)
      emitterNode!.position = <span class="type">CGPoint</span>(x: size.<span class="property">width</span>*<span class="number">0.18</span>, y: size.<span class="property">height</span>*<span class="number">0.5</span> - <span class="number">25</span>)
      sunSprite.<span class="property">position</span> = <span class="type">CGPoint</span>(x: size.<span class="property">width</span>/<span class="number">2</span>, y: <span class="number">0</span>)
      gravityField.<span class="property">position</span> = <span class="type">CGPoint</span>(x: size.<span class="property">width</span>/<span class="number">2</span>, y: <span class="number">0</span>)
    }
  }
</code></pre><p>Let’s run this - and as you can see, there is now a star in the bottom part of the scene, and some of the asteroids that get too close to the sun are drawn into the sun, never to be seen again. Asteroids that flyby out of range of the sun’s gravity continue on their journey.</p><p>In the final module on <code>SpriteKit</code>, we'll look at how to interact with your scene.</p><p style="float: left">Previous:  <A HREF="../11-SpriteKitBackgrounds/index.html">SpriteKit Backgrounds</A></p><p style="float: right">Next:  <A HREF="../13-SpriteKitInteractions/index.html" class="nextModule">SpriteKit Interactions</A></p></div><footer><p>Generated with ❤️ using <a href="https://github.com/johnsundell/publish">Publish</a></p><p>© 2023-2024 Josh Steele (rsteele3@jhu.edu) <a href="mailto:"(rsteele3@jhu.edu)""></a></p><p>Last updated January 21, 2024 at 1:48 PM</p><p><a href="https://mastodon.social/@hococoder" target="_blank">My Mastodon</a> | <a href="https://github.com/hococoder" target="_blank">My GitHub</a> | <a href="https://ep.jhu.edu" target="_blank">Whiting School EPP</a> | <a href="https://canvas.jhu.edu" target="_blank">JHU Canvas</a></p></footer></body></html>