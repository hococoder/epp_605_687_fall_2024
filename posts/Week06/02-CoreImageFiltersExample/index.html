<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Mobile Application Development for the iOS Platform"/><link rel="canonical" href="https://hococoder.com/posts/Week06/02-CoreImageFiltersExample"/><meta name="twitter:url" content="https://hococoder.com/posts/Week06/02-CoreImageFiltersExample"/><meta name="og:url" content="https://hococoder.com/posts/Week06/02-CoreImageFiltersExample"/><title>Week 6 - Core Image Filters Example | Mobile Application Development for the iOS Platform</title><meta name="twitter:title" content="Week 6 - Core Image Filters Example | Mobile Application Development for the iOS Platform"/><meta name="og:title" content="Week 6 - Core Image Filters Example | Mobile Application Development for the iOS Platform"/><meta name="description" content="A description of my first post."/><meta name="twitter:description" content="A description of my first post."/><meta name="og:description" content="A description of my first post."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><link rel="stylesheet" href="../../../styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Mobile Application Development for the iOS Platform"/></head><body><header><div class="wrapper"><a class="site-name" href="/">Mobile Application Development for the iOS Platform</a><nav><ul><li><a href="/epp_605_687_spring_2024/posts/Intro/About Me">AboutMe</a></li><li><a href="/epp_605_687_spring_2024/posts/Intro/Example App">ExampleApp</a></li><li><a href="/epp_605_687_spring_2024/posts/Week00/00-Week00Overview">Week0</a></li><li><a href="/epp_605_687_spring_2024/posts/Week01/00-Week01Overview">Week1</a></li><li><a href="/epp_605_687_spring_2024/posts/Week02/00-Week02Overview">Week2</a></li><li><a href="/epp_605_687_spring_2024/posts/Week03/00-Week03Overview">Week3</a></li><li><a href="/epp_605_687_spring_2024/posts/Week04/00-Week04Overview">Week4</a></li><li><a href="/epp_605_687_spring_2024/posts/Week05/00-Week05Overview">Week5</a></li><li><a href="/epp_605_687_spring_2024/posts/Week06/00-Week06Overview">Week6</a></li><li><a href="/epp_605_687_spring_2024/posts/Week07/00-Week07Overview">Week7</a></li><li><a href="/epp_605_687_spring_2024/posts/Week08/00-Week08Overview">Week8</a></li><li><a href="/epp_605_687_spring_2024/posts/Week09/00-Week09Overview">Week9</a></li><li><a href="/epp_605_687_spring_2024/posts/Week10/00-Week10Overview">Week10</a></li><li><a href="/epp_605_687_spring_2024/posts/Week11/00-Week11Overview">Week11</a></li><li><a href="/epp_605_687_spring_2024/posts/Week12/00-Week12Overview">Week12</a></li><li><a href="/epp_605_687_spring_2024/posts/Week13/00-Week13Overview">Week13</a></li></ul></nav></div></header><div class="wrapper"><h1>Week 6 - Core Image Filters Example</h1><p style="float: left">Previous:  <A HREF="../01-IntroductionToCoreImage/index.html">Introduction to Core Image</A></p><p style="float: right">Next:  <A HREF="../03-VisionFaceDetectionExample/index.html" class="nextModule">Vision Face Detection Example</A></p><BR/><BR/><center> <iframe width="1280" height="720" src="https://cdnapisec.kaltura.com/html5/html5lib/v2.81.2/mwEmbedFrame.php/p/1458241/uiconf_id/14487351/entry_id/1_jyxryrc0?wid=_1458241&iframeembed=true&playerId=kaltura_player&entry_id=1_jyxryrc0&flashvars[localizationCode]=en&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[mediaProxy.preferedFlavorBR]=2500&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;flashvars[EmbedPlayer.NotPlayableDownloadLink]=true;&wid=1_abkvs1gz"allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" sandbox="allow-forms allow-same-origin allow-scripts allow-top-navigation allow-pointer-lock allow-popups allow-modals allow-orientation-lock allow-popups-to-escape-sandbox allow-presentation allow-top-navigation-by-user-activation" frameborder="0" title="Kaltura Player">
  </iframe>
</center><p>There are a series of built in <code>CoreImage</code> filters that you can apply to an image, and even chain together in order to apply multiple filters at the same time. In my project, I've got a SwiftUI view with an image and 2 buttons already set up - one to add a filter, and another to detect faces, which you'll learn about in the next video.</p><p>At the top of the <code>CoreImageView</code>, I've declared a <code>CIContext</code> - which is our scratch space - and a filter that performs a disc blur. There are also <code>@State</code> properties wrappers for the Image itself, as well as a UIImage - which is how you create images in UIKit. This is because the line from SwiftUI to <code>CoreImage</code> is... a long and winding road, but one we'll navigate down.</p><pre><code><span class="keyword">let</span> context = <span class="type">CIContext</span>(options: <span class="keyword">nil</span>)
<span class="keyword">let</span> ciFilter = <span class="type">CIFilter</span>.<span class="call">discBlur</span>()
<span class="keyword">@State var</span> image: <span class="type">Image</span>?
<span class="keyword">@State var</span> uiImage: <span class="type">UIImage</span>!
</code></pre><p>In the <code>body</code> for the <code>View</code>, there is a <code>VStack</code> with the <code>Image</code> and 2 buttons.</p><p class="new"> Note that I've removed the resizeable and aspectRatio modifiers from the image - they were interfering with the placement of the face regions in the next module.  I've also cleaned up the UI layout a bit.</p><pre><code><span class="type">VStack</span>(alignment: .<span class="dotAccess">center</span>) {
    image
    <span class="type">Spacer</span>()
    <span class="type">HStack</span> {
      <span class="type">Button</span>(<span class="string">"Apply Filter"</span>) { <span class="keyword">self</span>.<span class="call">applyFilter</span>() }
      <span class="type">Spacer</span>()
      <span class="type">Button</span>(<span class="string">"Find Faces"</span>) { <span class="keyword">self</span>.<span class="call">boxFaces</span>()  }
    }.<span class="call">padding</span>()
}.<span class="call">onAppear</span>(perform: loadImage)
</code></pre><p>You may have picked up on a few things. First, the image property is optional, and isn't immediately set. Even when the view is defined, the image isn't set, but remains declared as optional, and only on the <code>VStack</code> appearing do we call the method <code>loadImage</code>, which is located below the <code>body</code> declaration.</p><pre><code><span class="keyword">func</span> loadImage() {

  <span class="keyword">guard let</span> uiImage = <span class="type">UIImage</span>(named: <span class="string">"cook_scaled"</span>) <span class="keyword">else</span> { <span class="keyword">return</span> }
  <span class="keyword">self</span>.<span class="property">uiImage</span> = uiImage
  image = <span class="type">Image</span>(uiImage: uiImage)
}

</code></pre><p>This method attempts to load the image via a UIImage, and if it makes it past the guard, sets the <code>uiImage</code> property, and initializes the <code>Image</code> with that <code>UIImage</code>.</p><p>Now, let's define the <code>applyFilter</code> function. First, make a <code>CIImage</code> from the <code>uiImage</code> (<code>CIImage</code> is a <code>CoreImage</code> Image)</p><pre><code><span class="keyword">func</span> applyFilter()
{
  <span class="keyword">let</span> ciImage = <span class="type">CIImage</span>(image: uiImage)
</code></pre><p>Next, take the filter, and set the input image for it, via the <code>setValue</code> method. <code>kCIInputImageKey</code> here is a constant defined in <code>CoreImage</code>. Also set the blur radius to 4</p><pre><code>  ciFilter.<span class="call">setValue</span>(ciImage, forKey: kCIInputImageKey)
  ciFilter.<span class="property">radius</span> = <span class="number">4</span>
</code></pre><p>Then, grab the output image from the filter, and if that fails, return</p><pre><code>  <span class="keyword">guard let</span> outputImage = ciFilter.<span class="property">outputImage</span> <span class="keyword">else</span> { <span class="keyword">return</span> }
</code></pre><p>Then - and here is where it gets wild - use the <code>context</code> to convert the <code>outputImage</code> (using the size defined in the <code>outputImage</code>'s <code>extent</code>) into a <code>CoreGraphics</code> image. Then from that, create a <code>UIImage</code>, and then from <em>that</em> set the SwiftUI <code>Image</code> property, which will cause the view to refresh since we marked it as a <code>@State</code> property.</p><pre><code><span class="keyword">if let</span> cgimg = context.<span class="call">createCGImage</span>(outputImage, from: outputImage.<span class="property">extent</span>) {
    <span class="comment">// convert that to a UIImage</span>
    uiImage = <span class="type">UIImage</span>(cgImage: cgimg)
    <span class="comment">// and convert that to a SwiftUI image</span>
    image = <span class="type">Image</span>(uiImage: uiImage!)
}

</code></pre><p>Run that in the simulator and you can see the image get blurry when you tap on the button.</p><p>You can also easily apply another filter using <code>applyingFilter</code> to the first outputImage, and using the output from <em>that</em> filter to create the <code>Image</code> object. <code>applyingFilter</code> takes in the name of a filter as well as a dictionary of parameters for that filter. Here we are setting the <code>intensity</code> for the SepiaTone filter to 1.0.</p><pre><code>  <span class="keyword">let</span> outputImage2 = outputImage.<span class="call">applyingFilter</span>(<span class="string">"CISepiaTone"</span>, parameters: [kCIInputIntensityKey : <span class="number">1.0</span>])
      
  <span class="keyword">if let</span> cgimg = context.<span class="call">createCGImage</span>(outputImage2, from: outputImage2.<span class="property">extent</span>) {
      <span class="comment">// convert that to a UIImage</span>
      uiImage = <span class="type">UIImage</span>(cgImage: cgimg)
      <span class="comment">// and convert that to a SwiftUI image</span>
      image = <span class="type">Image</span>(uiImage: uiImage!)
  }
}

</code></pre><p>Run that again and you'll see that the image gets blurry and turns to a sepia tone.<br><br>Core Image’s filter API is pretty straightforward to use (except when using SwiftUI, which hopefully will improve soon), letting you apply and combine filters to images. If you have any questions about the examples in this video, please post them in the forums.</p><p style="float: left">Previous:  <A HREF="../01-IntroductionToCoreImage/index.html">Introduction to Core Image</A></p><p style="float: right">Next:  <A HREF="../03-VisionFaceDetectionExample/index.html" class="nextModule">Vision Face Detection Example</A></p></div><footer><p>Generated with ❤️ using <a href="https://github.com/johnsundell/publish">Publish</a></p><p>© 2023-2024 Josh Steele (rsteele3@jhu.edu) <a href="mailto:"(rsteele3@jhu.edu)""></a></p><p>Last updated January 21, 2024 at 1:48 PM</p><p><a href="https://mastodon.social/@hococoder" target="_blank">My Mastodon</a> | <a href="https://github.com/hococoder" target="_blank">My GitHub</a> | <a href="https://ep.jhu.edu" target="_blank">Whiting School EPP</a> | <a href="https://canvas.jhu.edu" target="_blank">JHU Canvas</a></p></footer></body></html>