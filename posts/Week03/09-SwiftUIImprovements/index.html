<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Mobile Application Development for the iOS Platform"/><link rel="canonical" href="https://hococoder.com/posts/Week03/09-SwiftUIImprovements"/><meta name="twitter:url" content="https://hococoder.com/posts/Week03/09-SwiftUIImprovements"/><meta name="og:url" content="https://hococoder.com/posts/Week03/09-SwiftUIImprovements"/><title>Week 3 - SwiftUI Improvements | Mobile Application Development for the iOS Platform</title><meta name="twitter:title" content="Week 3 - SwiftUI Improvements | Mobile Application Development for the iOS Platform"/><meta name="og:title" content="Week 3 - SwiftUI Improvements | Mobile Application Development for the iOS Platform"/><meta name="description" content="A description of my first post."/><meta name="twitter:description" content="A description of my first post."/><meta name="og:description" content="A description of my first post."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><link rel="stylesheet" href="../../../styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Mobile Application Development for the iOS Platform"/></head><body><header><div class="wrapper"><a class="site-name" href="/">Mobile Application Development for the iOS Platform</a><nav><ul><li><a href="/epp_605_687_spring_2024/posts/Intro/About Me">AboutMe</a></li><li><a href="/epp_605_687_spring_2024/posts/Intro/Example App">ExampleApp</a></li><li><a href="/epp_605_687_spring_2024/posts/Week00/00-Week00Overview">Week0</a></li><li><a href="/epp_605_687_spring_2024/posts/Week01/00-Week01Overview">Week1</a></li><li><a href="/epp_605_687_spring_2024/posts/Week02/00-Week02Overview">Week2</a></li><li><a href="/epp_605_687_spring_2024/posts/Week03/00-Week03Overview">Week3</a></li><li><a href="/epp_605_687_spring_2024/posts/Week04/00-Week04Overview">Week4</a></li><li><a href="/epp_605_687_spring_2024/posts/Week05/00-Week05Overview">Week5</a></li><li><a href="/epp_605_687_spring_2024/posts/Week06/00-Week06Overview">Week6</a></li><li><a href="/epp_605_687_spring_2024/posts/Week07/00-Week07Overview">Week7</a></li><li><a href="/epp_605_687_spring_2024/posts/Week08/00-Week08Overview">Week8</a></li><li><a href="/epp_605_687_spring_2024/posts/Week09/00-Week09Overview">Week9</a></li><li><a href="/epp_605_687_spring_2024/posts/Week10/00-Week10Overview">Week10</a></li><li><a href="/epp_605_687_spring_2024/posts/Week11/00-Week11Overview">Week11</a></li><li><a href="/epp_605_687_spring_2024/posts/Week12/00-Week12Overview">Week12</a></li><li><a href="/epp_605_687_spring_2024/posts/Week13/00-Week13Overview">Week13</a></li></ul></nav></div></header><div class="wrapper"><h1>Week 3 - SwiftUI Improvements</h1><p style="float: left">Previous:  <A HREF="../08-PopulatingTheDatabase/index.html">Populating the Database</A></p><p style="float: right">Previous:  <A HREF="../10-IntroductionToSwiftData/index.html" class="nextModule">Introduction to SwiftData</A></p><BR/><BR/><center> <iframe width="1280" height="720" src="https://cdnapisec.kaltura.com/html5/html5lib/v2.81.2/mwEmbedFrame.php/p/1458241/uiconf_id/14487351/entry_id/1_nk5nd5b3?wid=_1458241&iframeembed=true&playerId=kaltura_player&entry_id=1_nk5nd5b3&flashvars[localizationCode]=en&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[mediaProxy.preferedFlavorBR]=2500&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;flashvars[EmbedPlayer.NotPlayableDownloadLink]=true;&wid=1_abkvs1gz"allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" sandbox="allow-forms allow-same-origin allow-scripts allow-top-navigation allow-pointer-lock allow-popups allow-modals allow-orientation-lock allow-popups-to-escape-sandbox allow-presentation allow-top-navigation-by-user-activation" frameborder="0" title="Kaltura Player">
  </iframe>
</center><BR/><BR/><h2>The SwiftUI Environment</h2><p>SwiftUI gives you some additional features that make working with databases even easier - especially when it comes to responding to changes in the database. Recall that the SwiftUI Environment system can be used to share information between screens that aren't necessarily linked to each other directly (they have to be in the same view hierarchy, however). There are a few ways to work with the environment, but we'll focus on using the <code>@Environment</code> property wrapper. Here's an example. If you make an Xcode project that uses SwiftUI and Core Data, the ContentView file gets some default code (as we've mentioned before):</p><pre><code><span class="keyword">struct</span> ContentView: <span class="type">View</span> {
    <span class="keyword">@Environment</span>(\.<span class="property">managedObjectContext</span>) <span class="keyword">private var</span> viewContext

    <span class="keyword">@FetchRequest</span>(
        sortDescriptors: [<span class="type">NSSortDescriptor</span>(keyPath: \<span class="type">Item</span>.<span class="property">timestamp</span>, ascending: <span class="keyword">true</span>)],
        animation: .<span class="dotAccess">default</span>)
    <span class="keyword">private var</span> items: <span class="type">FetchedResults</span>&lt;<span class="type">Item</span>&gt;

    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {
</code></pre><p>The <code>context</code> property defined in the <code>ContentView</code> gets automatically hooked up to the <code>managedObjectContext</code> property in the environment. But where did that get set? Let's go over to the main app file, and you'll see that the App template injected the context into the environment, assigning the context (which it gets from the shared <code>PersistenceController</code> object) to the <code>\.managedObjectContext</code> key in the environment</p><pre><code><span class="keyword">import</span> SwiftUI

<span class="keyword">@main
struct</span> SwiftUIImprovementsForCoreDataApp: <span class="type">App</span> {
    <span class="keyword">let</span> persistenceController = <span class="type">PersistenceController</span>.<span class="property">shared</span>

    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">Scene</span> {
        <span class="type">WindowGroup</span> {
          <span class="type">ContentView</span>()
            .<span class="call">environment</span>(\.<span class="property">managedObjectContext</span>, persistenceController.<span class="property">container</span>.<span class="property">viewContext</span>)
        }
    }
}
</code></pre><p>Using the <code>.environment</code> modifier to pass in the context object here injects it into our Environment, making it available to any view that is below the <code>ContentView</code> (including the <code>ContentView</code> itself) in the view hierarchy. We'll see another way to access the environment in the examples below as we grow the app's capabilities.</p><h2>The <code>@FetchRequest</code> property wrapper</h2><p>One of the more complicated features of Core Data in the past was keeping your user interface synced with the database as the values in it changed. Luckily that sounds like a great example of SwiftUI and Combine in action, and this is where the <code>@FetchedResults</code> property wrapper comes into play. Instead of using the JSON data to populate our arrays, we can use fetched results from the database. In the <code>ContentView</code>, note that there is already an <code>@FetchRequest</code> property wrapper here for you, and it is used to fetch the <code>Item</code>s from the database</p><pre><code><span class="keyword">struct</span> ContentView: <span class="type">View</span> {
  <span class="keyword">@Environment</span>(\.<span class="property">managedObjectContext</span>) <span class="keyword">private var</span> viewContext

  <span class="keyword">@FetchRequest</span>(
      sortDescriptors: [<span class="type">NSSortDescriptor</span>(keyPath: \<span class="type">Item</span>.<span class="property">timestamp</span>, ascending: <span class="keyword">true</span>)],
      animation: .<span class="dotAccess">default</span>)
  <span class="keyword">private var</span> items: <span class="type">FetchedResults</span>&lt;<span class="type">Item</span>&gt;

  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {
      <span class="type">NavigationStack</span> {
          <span class="type">List</span> {
              <span class="type">ForEach</span>(items) { item <span class="keyword">in</span>
                  <span class="type">NavigationLink</span> {
                      <span class="type">Text</span>(<span class="string">"Item at</span> \(item.<span class="property">timestamp</span>!, formatter: itemFormatter)<span class="string">"</span>)
                  } label: {
                      <span class="type">Text</span>(item.<span class="property">timestamp</span>!, formatter: itemFormatter)
                  }
              }
              .<span class="call">onDelete</span>(perform: deleteItems)
          }
          .<span class="call">toolbar</span> {
              <span class="type">ToolbarItem</span>(placement: .<span class="dotAccess">navigationBarTrailing</span>) {
                  <span class="type">EditButton</span>()
              }
              <span class="type">ToolbarItem</span> {
                  <span class="type">Button</span>(action: addItem) {
                      <span class="type">Label</span>(<span class="string">"Add Item"</span>, systemImage: <span class="string">"plus"</span>)
                  }
              }
          }
          <span class="type">Text</span>(<span class="string">"Select an item"</span>)
      }
  }
</code></pre><p>If you recall from the discussions on <code>NSFetchRequest</code> (or database queries in general), the elements here should look pretty familiar:</p><ul><li>An entity (or table) to query on</li><li>Any sorting rules for the results</li><li>And the predicate to refine the query to get exactly what you are looking for.</li></ul><p>The important thing here is that the properties are wrapped with <code>@FetchRequest</code>, which sets up the properties to be subscribers to changes coming from this particular request. So when the values in the database change, it causes the properties to change, which causes the view to refresh.</p><p>You might look at all this and think it isn't very Swift-like. You're right! In the next module, you'll see Apple's answer to that with SwiftData.</p><p style="float: left">Previous:  <A HREF="../08-PopulatingTheDatabase/index.html">Populating the Database</A></p><p style="float: right">Previous:  <A HREF="../10-IntroductionToSwiftData/index.html" class="nextModule">Introduction to SwiftData</A></p></div><footer><p>Generated with ❤️ using <a href="https://github.com/johnsundell/publish">Publish</a></p><p>© 2023-2024 Josh Steele (rsteele3@jhu.edu) <a href="mailto:"(rsteele3@jhu.edu)""></a></p><p>Last updated January 21, 2024 at 1:48 PM</p><p><a href="https://mastodon.social/@hococoder" target="_blank">My Mastodon</a> | <a href="https://github.com/hococoder" target="_blank">My GitHub</a> | <a href="https://ep.jhu.edu" target="_blank">Whiting School EPP</a> | <a href="https://canvas.jhu.edu" target="_blank">JHU Canvas</a></p></footer></body></html>