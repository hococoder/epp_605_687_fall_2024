<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Mobile Application Development for the iOS Platform"/><link rel="canonical" href="https://hococoder.com/posts/Week03/08-PopulatingTheDatabase"/><meta name="twitter:url" content="https://hococoder.com/posts/Week03/08-PopulatingTheDatabase"/><meta name="og:url" content="https://hococoder.com/posts/Week03/08-PopulatingTheDatabase"/><title>Week 3 - Populating the Database | Mobile Application Development for the iOS Platform</title><meta name="twitter:title" content="Week 3 - Populating the Database | Mobile Application Development for the iOS Platform"/><meta name="og:title" content="Week 3 - Populating the Database | Mobile Application Development for the iOS Platform"/><meta name="description" content="A description of my first post."/><meta name="twitter:description" content="A description of my first post."/><meta name="og:description" content="A description of my first post."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><link rel="stylesheet" href="../../../styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Mobile Application Development for the iOS Platform"/></head><body><header><div class="wrapper"><a class="site-name" href="/">Mobile Application Development for the iOS Platform</a><nav><ul><li><a href="/epp_605_687_spring_2024/posts/Intro/About Me">AboutMe</a></li><li><a href="/epp_605_687_spring_2024/posts/Intro/Example App">ExampleApp</a></li><li><a href="/epp_605_687_spring_2024/posts/Week00/00-Week00Overview">Week0</a></li><li><a href="/epp_605_687_spring_2024/posts/Week01/00-Week01Overview">Week1</a></li><li><a href="/epp_605_687_spring_2024/posts/Week02/00-Week02Overview">Week2</a></li><li><a href="/epp_605_687_spring_2024/posts/Week03/00-Week03Overview">Week3</a></li><li><a href="/epp_605_687_spring_2024/posts/Week04/00-Week04Overview">Week4</a></li><li><a href="/epp_605_687_spring_2024/posts/Week05/00-Week05Overview">Week5</a></li><li><a href="/epp_605_687_spring_2024/posts/Week06/00-Week06Overview">Week6</a></li><li><a href="/epp_605_687_spring_2024/posts/Week07/00-Week07Overview">Week7</a></li><li><a href="/epp_605_687_spring_2024/posts/Week08/00-Week08Overview">Week8</a></li><li><a href="/epp_605_687_spring_2024/posts/Week09/00-Week09Overview">Week9</a></li><li><a href="/epp_605_687_spring_2024/posts/Week10/00-Week10Overview">Week10</a></li><li><a href="/epp_605_687_spring_2024/posts/Week11/00-Week11Overview">Week11</a></li><li><a href="/epp_605_687_spring_2024/posts/Week12/00-Week12Overview">Week12</a></li><li><a href="/epp_605_687_spring_2024/posts/Week13/00-Week13Overview">Week13</a></li></ul></nav></div></header><div class="wrapper"><h1>Week 3 - Populating the Database</h1><p style="float: left">Previous:  <A HREF="../07-StoringAndFetching/index.html">Storing and Fetching</A></p><p style="float: right">Next:  <A HREF="../09-SwiftUIImprovements/index.html" class="nextModule">SwiftUI Improvements</A></p><BR/><BR/><h2>Why do we need a database?</h2><p>Up to this point, we had read in our data from a set of JSON files, and considered that to be our truth. This is read only, however, and we want something that we can write to as well. This is where the database will come in. We'll still use the JSON files to initialize our database however - but now we'll have the option of both reading AND writing data to our model via the database. Let's talk about how to do that here.<br><br>## Populating the Database</p><p>To get our JSON file into the database, you need to:</p><ul><li>Convert the JSON object to an entity (e.g. Teacher)</li><li>Save that entity to the database.</li></ul><p>You'll do this in your homework assignment this week, so no spoilers here!</p><h2>Deleting Previous Entries</h2><p>In the last module, you learned one way to delete entries from the database. Here's another way to delete entries in bulk: using <code>NSBatchDeleteRequest</code>:</p><pre><code><span class="keyword">let</span> teacherFetchRequest: <span class="type">NSFetchRequest</span>&lt;<span class="type">NSFetchRequestResult</span>&gt; = <span class="type">Teacher</span>.<span class="call">fetchRequest</span>()
<span class="keyword">let</span> teacherDeleteRequest = <span class="type">NSBatchDeleteRequest</span>(fetchRequest: teacherFetchRequest)

<span class="keyword">do</span> {
  <span class="keyword">try</span> context.<span class="call">execute</span>(teacherDeleteRequest)
} <span class="keyword">catch let</span> error <span class="keyword">as</span> <span class="type">NSError</span> {
  <span class="call">print</span>(<span class="string">"error during deletion</span> \(error.<span class="property">localizedDescription</span>)<span class="string">"</span>)
}
</code></pre><p>The fetch request to get all the <code>Teacher</code> values from the database is passed into the <code>NSBatchDeleteRequest</code>, and this delete request is executed on the context to carry out the deletion. Pretty simple! The deletion may throw an error, so it has to be wrapped in a do/catch block.</p><h2>Getting data with Predicates</h2><p>Next, let's make some helper methods to get data from the database. Both of these are similar: make a fetch request, assign a <code>NSPredicate</code> to restrict what values you get back, and then ask the context to perform the fetch request and return the results. Note that the <code>NSPredicate</code> uses a c-style format string to build the predicate for the query.</p><pre><code>   <span class="keyword">static func</span> getCourseClassWith(name: <span class="type">String</span>) -&gt; <span class="type">CourseClass</span>?
  {
    <span class="keyword">let</span> request: <span class="type">NSFetchRequest</span>&lt;<span class="type">CourseClass</span>&gt; = <span class="type">CourseClass</span>.<span class="call">fetchRequest</span>()
    request.<span class="property">predicate</span> = <span class="type">NSPredicate</span>(format: <span class="string">"courseClassName == %@"</span>, name)
    
    <span class="keyword">do</span> {
      <span class="keyword">let</span> courseClass = <span class="keyword">try</span> context.<span class="call">fetch</span>(request).<span class="property">first</span>
      <span class="keyword">return</span> courseClass
    } <span class="keyword">catch</span> {
      <span class="call">print</span>(<span class="string">"school class fetch failed"</span>)
      <span class="keyword">return nil</span>
    }
  }
</code></pre><p>This function returns a Course with the given name by passing the name into a predicate, which only returns Courses where the <code>name</code> attribute matches what you passed in.</p><h2>Assign relationships</h2><p>Now since we can get values, we also need to establish relationships between objects, where applicable. We'll define the <code>Teacher</code> to <code>CourseClass</code> relationship here. Here, we have to use the information passed into the method to grab the appropriate objects from the database (like the get method above) and then again take advantage of the auto-generated code from CoreData. <code>addToActivelyTeaching</code> will assign the class to the teacher's "activelyTeaching" set. Calling save pushes the relationship to the database.</p><pre><code>   <span class="keyword">func</span> assign(teacher jhed: <span class="type">String</span>, toCourseClass courseClassName: <span class="type">String</span>)
  {
    <span class="keyword">let</span> teacherRequest: <span class="type">NSFetchRequest</span>&lt;<span class="type">Teacher</span>&gt; = <span class="type">Teacher</span>.<span class="call">fetchRequest</span>()
    teacherRequest.<span class="property">predicate</span> = <span class="type">NSPredicate</span>(format: <span class="string">"jhed == %@"</span>, jhed)
    
    <span class="keyword">let</span> schoolClassRequest: <span class="type">NSFetchRequest</span>&lt;<span class="type">CourseClass</span>&gt; = <span class="type">CourseClass</span>.<span class="call">fetchRequest</span>()
    schoolClassRequest.<span class="property">predicate</span> = <span class="type">NSPredicate</span>(format: <span class="string">"courseClassName == %@"</span>, courseClassName)
    <span class="keyword">do</span> {
      <span class="keyword">let</span> teacher = <span class="keyword">try</span> context.<span class="call">fetch</span>(teacherRequest).<span class="property">first</span>!
      <span class="keyword">let</span> courseClass = <span class="keyword">try</span> context.<span class="call">fetch</span>(schoolClassRequest).<span class="property">first</span>!
      <span class="comment">//adds this course class to the teacher's "activelyTeaching" array</span>
      teacher.<span class="call">addToActivelyTeaching</span>(courseClass)
      <span class="keyword">try</span> context.<span class="call">save</span>()
    } <span class="keyword">catch</span> {
      <span class="call">print</span>(<span class="string">"Assignment of teacher to class failed"</span>)
    }
  }
</code></pre><p>As stated earlier, any helper methods like this should be defined in some sort of Core Data helper class (possibly using static methods) that you can invoke where needed. Don't put them in your SwiftUI views, which should focus on simply that - views.</p><p>Speaking of SwiftUI, in the next module you'll learn how you can use CoreData in your SwiftUI views.</p><p style="float: left">Previous:  <A HREF="../07-StoringAndFetching/index.html">Storing and Fetching</A></p><p style="float: right">Next:  <A HREF="../09-SwiftUIImprovements/index.html" class="nextModule">SwiftUI Improvements</A></p></div><footer><p>Generated with ❤️ using <a href="https://github.com/johnsundell/publish">Publish</a></p><p>© 2023-2024 Josh Steele (rsteele3@jhu.edu) <a href="mailto:"(rsteele3@jhu.edu)""></a></p><p>Last updated January 21, 2024 at 1:48 PM</p><p><a href="https://mastodon.social/@hococoder" target="_blank">My Mastodon</a> | <a href="https://github.com/hococoder" target="_blank">My GitHub</a> | <a href="https://ep.jhu.edu" target="_blank">Whiting School EPP</a> | <a href="https://canvas.jhu.edu" target="_blank">JHU Canvas</a></p></footer></body></html>